"use strict";const e=require("../../common/vendor.js"),m=require("../../common/assets.js"),h=require("../../utils/uploadFile.js"),y=require("../../utils/runWorkflow.js");if(!Array){const p=e.resolveComponent("u-icon"),n=e.resolveComponent("u-line-progress"),u=e.resolveComponent("u-button");(p+n+u)()}const w=()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js",b=()=>"../../node-modules/uview-plus/components/u-line-progress/u-line-progress.js",x=()=>"../../node-modules/uview-plus/components/u-button/u-button.js";Math||(w+b+x)();const N={__name:"upload",setup(p){const n=e.ref(!1),u=e.ref(0);e.onMounted(()=>{try{const o=e.index.getSystemInfoSync();u.value=o.statusBarHeight||0,console.log("状态栏高度:",u.value)}catch(o){console.error("获取系统信息失败:",o)}setTimeout(()=>{n.value=!0},300)});const i=e.ref([{type:"file",file_id:""},{type:"file",file_id:""},{type:"file",file_id:""}]),l=e.ref([{title:"学生资助申请表",uploaded:!1,uploading:!1,progress:0,fileName:"",fileData:null},{title:"食堂消费数据",uploaded:!1,uploading:!1,progress:0,fileName:"",fileData:null},{title:"志愿服务记录",uploaded:!1,uploading:!1,progress:0,fileName:"",fileData:null}]),d=e.computed(()=>l.value.every(o=>o.uploaded)),f=()=>{e.index.navigateBack()},g=o=>{const t={count:1,type:"file",extension:[".pdf",".doc",".docx",".xls",".xlsx"]};l.value[o].uploading=!0,l.value[o].progress=0,h.uploadFile.chooseAndUploadFile(t).then(s=>{console.log("文件上传成功:",s),l.value[o].fileName=s.fileName||"已上传文件",l.value[o].fileData=s,l.value[o].uploaded=!0,l.value[o].uploading=!1,l.value[o].progress=100,e.index.showToast({title:"上传成功",icon:"success"}),i.value[o].file_id=s.id}).catch(s=>{console.error("文件上传失败:",s),l.value[o].uploading=!1,l.value[o].progress=0,e.index.showToast({title:s.errMsg||"上传失败",icon:"none"})})},_=()=>{e.index.navigateTo({url:"/pages/result/result"})};e.index.$on("uploadProgress",o=>{o&&o.index!==void 0&&o.progress!==void 0&&(l.value[o.index].progress=o.progress)});const v=()=>{if(d.value){e.index.showLoading({title:"提交中..."});const o=[];let t=0;i.value.forEach((s,a)=>{let r={workflow_id:"7491208390270746665",parameters:{input:s}};y.runWorkflow(r).then(c=>{o[a]={index:a,fileName:l.value[a].fileName,data:c.data},t++,t===i.value.length&&(e.index.hideLoading(),e.index.setStorageSync("uploadResults",o),e.index.navigateTo({url:"/pages/result/result"}))}).catch(c=>{e.index.hideLoading(),e.index.showToast({title:"提交失败",icon:"none"})})})}else e.index.showToast({title:"请上传所有必要文件",icon:"none"})};return e.onBeforeUnmount(()=>{e.index.$off("uploadProgress")}),(o,t)=>({a:m._imports_0,b:e.p({name:"arrow-left",color:"#1b5e20",size:"24"}),c:e.o(f),d:e.f(l.value,(s,a,r)=>e.e({a:"aa5cff34-1-"+r,b:e.p({name:s.uploaded?"checkmark-circle":"plus-circle",size:"40",color:s.uploaded?"#43a047":"#66bb6a"}),c:e.t(s.title),d:!s.uploading},s.uploading?{}:{e:e.t(s.uploaded?"已上传":"点击上传")},{f:s.fileName},s.fileName?{g:e.t(s.fileName)}:{},{h:s.uploading},s.uploading?{i:"aa5cff34-2-"+r,j:e.p({percentage:s.progress,"show-text":!1,height:"4","active-color":"#43a047"}),k:e.t(s.progress)}:{},{l:e.o(c=>g(a),a),m:a})),e:e.o(v),f:e.p({text:"提交资料",type:"primary",size:"large",disabled:!d.value,"hover-class":"button-hover"}),g:e.o(_),h:e.p({text:"test",type:"primary",size:"large","hover-class":"button-hover"}),i:n.value?1:""})}},k=e._export_sfc(N,[["__scopeId","data-v-aa5cff34"]]);wx.createPage(k);
