"use strict";const e=require("../../common/vendor.js"),Y=require("../../common/assets.js"),J=require("../../utils/runWorkflow.js");if(!Array){const B=e.resolveComponent("u-icon"),f=e.resolveComponent("up-icon"),r=e.resolveComponent("up-popup");(B+f+r)()}const X=()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js",Z=()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js",ee=()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js";Math||(X+Z+ee)();const oe="analysis_result_cache",ae={__name:"result",setup(B){const f=e.index.getStorageSync("uploadResults"),r=e.ref(null),S=e.ref(!0),P=e.ref(!1),N=e.ref(!1),g=e.ref(0),d=e.ref(0),T=e.ref(""),q=e.ref(""),F=e.ref(0),$=e.ref(0),n=e.ref(!0),i=e.ref(!1),z=e.ref(!0),D=e.ref(!0);e.ref(!0);const k=e.ref(0),m=e.ref(""),p=e.ref(null),M=e.ref(!1),C=e.ref({}),_=e.ref({workflow_id:"7491272557266976819",parameters:{score:0,shenqinshu:"",sizheng:"",shitang:""}}),L=o=>o?o.split(`
`)[0]:"",O=(o,a,t=100)=>{a.value="";let u=0;const c=()=>{if(u<o.length){a.value+=o[u],u++;const l=Math.max(t-u*.5,20);setTimeout(c,l)}};c()},x=(o,a,t=1e3)=>{o.value=0;const u=0,c=a/(t/16);let l=u;const h=setInterval(()=>{l+=c,l>=a?(o.value=a,clearInterval(h)):o.value=Math.floor(l)},16)},A=()=>{const o=Math.round(g.value*.6+d.value*.4);o>=80?m.value="该学生综合表现优秀，建议给予重点资助。":o>=60?m.value="该学生综合表现良好，建议给予适当资助。":o>=40?m.value="该学生综合表现一般，建议给予基本资助。":m.value="该学生综合表现欠佳，建议给予基础资助。"},W=()=>{n.value=!0;let o={workflow_id:"7491209530827636771",parameters:{input:f}};J.runWorkflow(o).then(a=>{let t=a.data;console.log(t),r.value=JSON.parse(t);const u={data:t,timestamp:Date.now()};e.index.setStorageSync(oe,JSON.stringify(u)),E(t),n.value=!1}).catch(a=>{console.error("获取数据失败:",a),e.index.showToast({title:"获取数据失败",icon:"none"}),n.value=!1})},E=o=>{var a,t,u,c,l,h,w,y,b,v;r.value=JSON.parse(o),$.value=((t=(a=r.value)==null?void 0:a.output3)==null?void 0:t.length)||0,O(((c=(u=r.value)==null?void 0:u.output1)==null?void 0:c.贫困特征分析)||"",T),O(((h=(l=r.value)==null?void 0:l.output2)==null?void 0:h.思政行为评估分析)||"",q),x(g,((y=(w=r.value)==null?void 0:w.output1)==null?void 0:y.贫困评分)||0),x(d,((v=(b=r.value)==null?void 0:b.output2)==null?void 0:v.思政评分)||0),x(F,$.value),setTimeout(()=>{A(),x(k,Math.round(g.value*.6+d.value*.4)),O(m.value,m),_.value.parameters.score=k.value,_.value.parameters.shenqinshu=f[0].data,_.value.parameters.shitang=f[1].data,_.value.parameters.sizheng=f[2].data,i.value=!0,J.runWorkflow(_.value).then(s=>{console.log("资助方案数据:",s.data),p.value=JSON.parse(s.data)}).catch(s=>{console.error("获取资助方案失败:",s),e.index.showToast({title:"获取资助方案失败",icon:"none"})}).finally(()=>{i.value=!1}),setTimeout(()=>{N.value=!0},500)},1e3)};e.onMounted(()=>{console.log("从本地存储读取的uploadResults:",f),e.nextTick$1(()=>{W()})});const G=()=>{e.index.navigateBack()},R=()=>{P.value=!P.value},H=()=>{z.value=!z.value},K=()=>{D.value=!D.value},Q=()=>{console.log("显示资助方案"),M.value=!0},j=()=>{console.log("关闭资助方案"),M.value=!1},U=()=>{},V=o=>{C.value[o]=!C.value[o]};return(o,a)=>{var t,u,c,l,h,w,y,b;return e.e({a:Y._imports_0,b:e.p({name:"arrow-left",color:"#1b5e20",size:"24"}),c:e.o(G),d:n.value},n.value?{}:e.e({e:e.t(k.value),f:`${k.value}%`,g:e.t(m.value),h:i.value},i.value?{}:{},{i:e.t(i.value?"加载中...":"智慧方案"),j:i.value?1:"",k:e.o(v=>!i.value&&Q()),l:e.o(U),m:N.value?1:""}),{n:S.value?1:"",o:n.value},n.value?{}:{p:e.t(F.value)},{q:e.p({name:P.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),r:e.o(R),s:n.value},n.value?{}:{t:e.f((t=r.value)==null?void 0:t.output3,(v,s,I)=>({a:e.t(v.title),b:e.t(v.summary),c:e.t(v.sitename),d:s}))},{v:P.value,w:e.t(g.value),x:e.p({name:z.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),y:e.o(H),z:n.value},n.value?{}:{A:e.t(T.value),B:`${g.value}%`},{C:z.value,D:S.value?1:"",E:e.t(d.value),F:e.p({name:D.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),G:e.o(K),H:n.value},n.value?{}:{I:e.t(q.value),J:`${d.value}%`},{K:D.value,L:S.value?1:"",M:e.p({name:"close",color:"#1b5e20",size:"20"}),N:e.o(j),O:i.value},i.value?{}:e.e({P:e.t(((u=p.value)==null?void 0:u.fangan)||"暂无资助方案"),Q:(c=p.value)==null?void 0:c.fanganimg},(l=p.value)!=null&&l.fanganimg?{R:p.value.fanganimg}:{},{S:(w=(h=p.value)==null?void 0:h.govs)==null?void 0:w.length},(b=(y=p.value)==null?void 0:y.govs)!=null&&b.length?{T:e.f(p.value.govs,(v,s,I)=>({a:e.t(C.value[s]?v.output:L(v.output)),b:"b615976f-6-"+I+",b615976f-4",c:e.p({name:C.value[s]?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),d:s,e:e.o(ue=>V(s),s)}))}:{}),{U:e.o(j),V:e.p({show:M.value,mode:"center",round:10,overlay:!0,closeOnClickOverlay:!0,safeAreaInsetBottom:!0}),W:S.value?1:""})}}},te=e._export_sfc(ae,[["__scopeId","data-v-b615976f"]]);wx.createPage(te);
