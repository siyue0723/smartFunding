"use strict";const e=require("../../common/vendor.js"),te=require("../../common/assets.js"),I=require("../../utils/runWorkflow.js");if(!Array){const $=e.resolveComponent("u-icon"),c=e.resolveComponent("up-icon"),v=e.resolveComponent("up-popup");($+c+v)()}const le=()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js",ne=()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js",ue=()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js";Math||(le+ne+ue)();const se="analysis_result_cache",re={__name:"result",setup($){const c=e.index.getStorageSync("uploadResults"),v=e.ref(null),w=e.ref(!0),z=e.ref(!1),q=e.ref(!1),_=e.ref(0),y=e.ref(0),J=e.ref(""),j=e.ref(""),W=e.ref(0),A=e.ref(0),u=e.ref(!0),i=e.ref(!1),x=e.ref(!0),C=e.ref(!0);e.ref(!0);const T=e.ref(!0),B=e.ref(0),h=e.ref(""),g=e.ref(null),N=e.ref(!1);e.ref(!1);const p=e.ref(!1),b=e.ref({attribute:"暂无数据",Behavior:"暂无数据",Psychology:"暂无数据",tags:"暂无数据"}),m=e.ref([]),L=e.ref({}),P=e.ref({workflow_id:"7491272557266976819",parameters:{score:0,shenqinshu:"",sizheng:"",shitang:""}});e.ref([]);const G=o=>o?o.split(`
`)[0]:"",F=(o,a,l=100)=>{a.value="";let t=0;const s=()=>{if(t<o.length){a.value+=o[t],t++;const r=Math.max(l-t*.5,20);setTimeout(s,r)}};s()},O=(o,a,l=1e3)=>{o.value=0;const t=0,s=a/(l/16);let r=t;const d=setInterval(()=>{r+=s,r>=a?(o.value=a,clearInterval(d)):o.value=Math.floor(r)},16)},R=()=>{const o=Math.round(_.value*.6+y.value*.4);o>=80?h.value="该学生综合表现优秀，建议给予重点资助。":o>=60?h.value="该学生综合表现良好，建议给予适当资助。":o>=40?h.value="该学生综合表现一般，建议给予基本资助。":h.value="该学生综合表现欠佳，建议给予基础资助。"},H=()=>{u.value=!0;let o={workflow_id:"7491209530827636771",parameters:{input:c}};I.runWorkflow(o).then(a=>{let l=a.data;console.log(l),v.value=JSON.parse(l);const t={data:l,timestamp:Date.now()};e.index.setStorageSync(se,JSON.stringify(t)),K(l),u.value=!1}).catch(a=>{console.error("获取数据失败:",a),e.index.showToast({title:"获取数据失败",icon:"none"}),u.value=!1})},K=o=>{var a,l,t,s,r,d,S,D,k,n;v.value=JSON.parse(o),A.value=((l=(a=v.value)==null?void 0:a.output3)==null?void 0:l.length)||0,F(((s=(t=v.value)==null?void 0:t.output1)==null?void 0:s.贫困特征分析)||"",J),F(((d=(r=v.value)==null?void 0:r.output2)==null?void 0:d.思政行为评估分析)||"",j),O(_,((D=(S=v.value)==null?void 0:S.output1)==null?void 0:D.贫困评分)||0),O(y,((n=(k=v.value)==null?void 0:k.output2)==null?void 0:n.思政评分)||0),O(W,A.value),setTimeout(()=>{R(),O(B,Math.round(_.value*.6+y.value*.4)),F(h.value,h),P.value.parameters.score=B.value,P.value.parameters.shenqinshu=c[0].data,P.value.parameters.shitang=c[1].data,P.value.parameters.sizheng=c[2].data,oe(),setTimeout(()=>{q.value=!0},500)},1e3)};e.onMounted(()=>{console.log("从本地存储读取的uploadResults:",c),e.nextTick$1(()=>{H(),Y()})});const Y=()=>{p.value=!0,console.log("fetchProfileData started, isProfileLoading:",p.value);const o={workflow_id:"7491300817274830899",parameters:{input1:c[0].data,input2:c[1].data,input3:c[2].data}};I.runWorkflow(o).then(a=>{console.log("画像原始数据:",a);let l=a.data,t;try{t=JSON.parse(l),console.log("画像解析后数据:",t)}catch(s){console.error("解析画像数据失败:",s),e.index.showToast({title:"解析画像数据格式错误",icon:"none"}),p.value=!1;return}b.value={attribute:t.attribute||"暂无数据",Behavior:t.Behavior||"暂无数据",Psychology:t.Psychology||"暂无数据",tags:t.tags||"暂无数据"},m.value=[{icon:"account",title:"基础信息",content:b.value.attribute},{icon:"star",title:"行为特征",content:b.value.Behavior},{icon:"heart",title:"心理特征",content:b.value.Psychology},{icon:"tags",title:"个人标签",content:b.value.tags}],console.log("profileItems 更新后:",m.value,"长度:",m.value.length),e.nextTick$1(()=>{p.value=!1,console.log("nextTick 后, isProfileLoading:",p.value)})}).catch(a=>{console.error("获取画像失败:",a),e.index.showToast({title:"获取画像失败",icon:"none"}),p.value=!1,console.log("catch 后, isProfileLoading:",p.value)})},Q=()=>{e.index.navigateBack()},U=()=>{z.value=!z.value},V=()=>{x.value=!x.value},X=()=>{C.value=!C.value},Z=()=>{T.value=!T.value},ee=()=>{console.log("显示资助方案"),N.value=!0},oe=()=>{i.value=!0,I.runWorkflow(P.value).then(o=>{console.log("资助方案数据:",o.data);try{g.value=JSON.parse(o.data)}catch(a){console.error("解析资助方案数据失败:",a),e.index.showToast({title:"解析资助方案数据失败",icon:"none"})}}).catch(o=>{console.error("获取资助方案失败:",o),e.index.showToast({title:"获取资助方案失败",icon:"none"})}).finally(()=>{i.value=!1})},E=()=>{console.log("关闭资助方案"),N.value=!1},ae=o=>{L.value[o]=!L.value[o]};return(o,a)=>{var l,t,s,r,d,S,D,k;return e.e({a:te._imports_0,b:e.p({name:"arrow-left",color:"#1b5e20",size:"24"}),c:e.o(Q),d:!p.value&&m.value.length>0},!p.value&&m.value.length>0?{e:e.p({name:T.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),f:e.o(Z),g:e.f(m.value,(n,f,M)=>({a:"b615976f-2-"+M,b:e.p({name:n.icon,color:"#1b5e20",size:"20"}),c:e.t(n.title),d:e.t(n.content),e:f})),h:T.value?1:"",i:w.value?1:""}:{},{j:u.value},u.value?{}:e.e({k:e.t(B.value),l:`${B.value}%`,m:e.t(h.value),n:i.value},i.value?{}:{},{o:e.t(i.value?"加载中...":"智慧方案"),p:i.value?1:"",q:e.o(n=>!i.value&&ee()),r:q.value?1:""}),{s:w.value?1:"",t:u.value},u.value?{}:{v:e.t(W.value)},{w:e.p({name:z.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),x:e.o(U),y:u.value},u.value?{}:{z:e.f((l=v.value)==null?void 0:l.output3,(n,f,M)=>({a:e.t(n.title),b:e.t(n.summary),c:e.t(n.sitename),d:f}))},{A:z.value,B:e.t(_.value),C:e.p({name:x.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),D:e.o(V),E:u.value},u.value?{}:{F:e.t(J.value),G:`${_.value}%`},{H:x.value,I:w.value?1:"",J:e.t(y.value),K:e.p({name:C.value?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),L:e.o(X),M:u.value},u.value?{}:{N:e.t(j.value),O:`${y.value}%`},{P:C.value,Q:w.value?1:"",R:e.p({name:"close",color:"#1b5e20",size:"20"}),S:e.o(E),T:i.value},i.value?{}:e.e({U:e.t(((t=g.value)==null?void 0:t.fangan)||"暂无资助方案"),V:(s=g.value)==null?void 0:s.fanganimg},(r=g.value)!=null&&r.fanganimg?{W:g.value.fanganimg}:{},{X:(S=(d=g.value)==null?void 0:d.govs)==null?void 0:S.length},(k=(D=g.value)==null?void 0:D.govs)!=null&&k.length?{Y:e.f(g.value.govs,(n,f,M)=>({a:e.t(L.value[f]?n.output:G(n.output)),b:"b615976f-8-"+M+",b615976f-6",c:e.p({name:L.value[f]?"arrow-up":"arrow-down",color:"#66bb6a",size:"16"}),d:f,e:e.o(ve=>ae(f),f)}))}:{}),{Z:e.o(E),aa:e.p({show:N.value,mode:"center",round:10,overlay:!0,closeOnClickOverlay:!0,safeAreaInsetBottom:!0}),ab:w.value?1:""})}}},ce=e._export_sfc(re,[["__scopeId","data-v-b615976f"]]);wx.createPage(ce);
